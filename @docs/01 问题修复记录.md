### Fix Record - 2025-01-17

-   **Problem Description:** coursera-dl在下载课程时出现JSON解析错误，错误信息为"Expecting value: line 1 column 1 (char 0)"，导致程序崩溃无法继续下载。
-   **Root Cause:** 
    1. 服务器返回的响应不是有效的JSON格式，可能是空响应、HTML错误页面或认证失败导致的重定向页面。
    2. **主要问题**：Coursera已废弃`onDemandCourseMaterials.v1` API端点，返回"API Route Does Not Exist"错误页面。
    3. 原代码在`network.py`的`get_page`函数中直接调用`reply.json()`而没有检查响应内容是否为空或有效。
-   **Solution:** 
    1. **更新API端点**：将`OPENCOURSE_ONDEMAND_COURSE_MATERIALS`从v1更新为v2 API端点。
    2. **增强错误处理**：在`coursera/network.py`的`get_page`函数中添加了JSON响应验证逻辑，检查响应是否为空，并在JSON解析失败时提供更详细的错误信息。
    3. **API响应兼容性**：在`coursera/api.py`的`OnDemandCourseMaterialItemsV1.create`方法中添加了v2和v1 API的兼容性处理，优先使用v2，回退到v1。
    4. **详细错误日志**：增加了详细的错误日志记录，帮助用户诊断认证或访问权限问题。
-   **Impact Scope:** 
    -   `coursera/define.py` (OPENCOURSE_ONDEMAND_COURSE_MATERIALS API端点)
    -   `coursera/network.py` (get_page函数)
    -   `coursera/api.py` (OnDemandCourseMaterialItemsV1.create方法)
    -   `venv39/lib/site-packages/coursera/` (虚拟环境中的对应文件)
-   **Test Result:** ✅ 修复成功，程序现在可以正常下载课程内容，包括视频、字幕、PDF等文件。

### Fix Record - 2025-01-17

-   **Problem Description:** 用户希望只下载中文字幕，避免下载多种语言的字幕文件占用存储空间。
-   **Root Cause:** coursera-dl默认下载所有可用语言的字幕文件，包括英语、法语、德语、西班牙语、中文等多种语言，导致文件数量庞大。
-   **Solution:** 
    1. **清理现有字幕**：删除所有非中文字幕文件（保留zh-CN格式的字幕）。
    2. **配置字幕语言**：使用`--subtitle-language zh-CN`参数指定只下载中文字幕。
    3. **创建配置文件**：创建`coursera-dl-chinese-only.conf`配置文件，方便以后使用。
    4. **验证完整性**：确认每个视频都有对应的中文字幕文件。
-   **Impact Scope:** 
    -   删除了约1000+个非中文字幕文件
    -   保留了95个中文字幕文件（.srt和.txt格式各48个）
    -   创建了`coursera-dl-chinese-only.conf`配置文件
-   **Test Result:** ✅ 成功清理并保留中文字幕，视频数量48个，中文字幕数量48个，完全匹配。

### Fix Record - 2025-01-17

-   **Problem Description:** 用户希望将cauth令牌保存到环境变量中，避免每次下载时都需要手动输入长令牌。
-   **Root Cause:** coursera-dl需要cauth令牌进行身份验证，但每次使用时都需要通过`--cauth`参数手动输入，使用不便。
-   **Solution:** 
    1. **设置环境变量**：将cauth令牌设置为用户级环境变量`COURSERA_CAUTH`，重启后仍然有效。
    2. **创建便捷脚本**：创建了批处理脚本(`download-coursera-chinese.bat`)和PowerShell脚本(`download-coursera-chinese.ps1`)。
    3. **更新配置文件**：在配置文件中添加了环境变量使用说明。
    4. **创建使用文档**：编写了详细的使用说明文档。
-   **Impact Scope:** 
    -   设置了用户级环境变量`COURSERA_CAUTH`
    -   创建了`download-coursera-chinese.bat`批处理脚本
    -   创建了`download-coursera-chinese.ps1`PowerShell脚本
    -   更新了`coursera-dl-chinese-only.conf`配置文件
    -   创建了`使用说明.md`文档
-   **Test Result:** ✅ 环境变量设置成功，脚本创建完成，用户现在可以通过简单的命令下载课程而无需手动输入令牌。

### Fix Record - 2025-01-17

-   **Problem Description:** 用户需要详细的使用文档，包括脚本使用说明和cauth令牌环境变量更新说明。
-   **Root Cause:** 工具功能复杂，需要详细的文档来指导用户正确使用，特别是cauth令牌的管理和环境变量的设置。
-   **Solution:** 
    1. **创建完整使用手册**：编写了`Coursera课程下载工具使用手册.md`，包含工具概述、环境准备、脚本使用、配置说明、故障排除等。
    2. **创建令牌管理指南**：编写了`cauth令牌管理指南.md`，详细说明令牌获取、设置、更新、故障排除和安全建议。
    3. **创建快速参考文档**：编写了`快速参考.md`，提供常用命令和快速解决方案。
    4. **更新README文件**：创建了项目主README文件，整合所有文档。
-   **Impact Scope:** 
    -   创建了`Coursera课程下载工具使用手册.md`（详细使用手册）
    -   创建了`cauth令牌管理指南.md`（令牌管理指南）
    -   创建了`快速参考.md`（快速参考文档）
    -   创建了`README.md`（项目主文档）
-   **Test Result:** ✅ 文档体系完整，涵盖从基础使用到高级管理的所有方面，用户可以根据需要选择合适的文档进行参考。
---
